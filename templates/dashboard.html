{% extends 'base.html' %}

{% block title %}Interfaz - Sistema Eléctrico{% endblock %}

{% block page_title %}Interfaz{% endblock %}

{% block content %}
    
    <!-- Bienvenida -->
    <div class="mb-4">
        <h3 class="text-primary"><i class="fas fa-user me-2"></i> Bienvenido, {{ request.session.nombre|default:request.session.username }}</h3>
        <p class="text-muted"><strong>Rol:</strong> {{ request.session.rol|capfirst }} | <strong>Usuario:</strong> {{ request.session.username }}</p>
    </div>

    <!-- Estadísticas Rápidas -->
    <div class="stats-grid">
        
        {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
        <div class="stat-tarjeta">
            <h4><i class="fas fa-users"></i> Clientes</h4>
            <h3>{{ total_clientes }}</h3>
            <p>Total registrados</p>
        </div>
        {% endif %}

        {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
        <div class="stat-tarjeta">
            <h4><i class="fas fa-file-contract"></i> Contratos</h4>
            <h3>{{ total_contratos }}</h3>
            <p>Contratos activos</p>
        </div>
        {% endif %}

        {% if request.session.rol == 'Administrador' or request.session.rol == 'Eléctrico' %}
        <div class="stat-tarjeta">
            <h4><i class="fas fa-tachometer-alt"></i> Medidores</h4>
            <h3>{{ total_medidores }}</h3>
            <p>Medidores instalados</p>
        </div>
        {% endif %}

        {% if request.session.rol == 'Administrador' or request.session.rol == 'Eléctrico' %}
        <div class="stat-tarjeta">
            <h4><i class="fas fa-chart-line"></i> Lecturas Pendientes</h4>
            <h3>{{ lecturas_pendientes }}</h3>
            <p>Requieren atención</p>
        </div>
        {% endif %}

        {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
        <div class="stat-tarjeta">
            <h4><i class="fas fa-file-invoice"></i> Boletas</h4>
            <h3>{{ boletas_emitidas }}</h3>
            <p>Emitidas este mes</p>
        </div>
        {% endif %}

        {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
        <div class="stat-tarjeta">
            <h4><i class="fas fa-credit-card"></i> Pagos</h4>
            <h3>{{ pagos_realizados }}</h3>
            <p>Procesados este mes</p>
        </div>
        {% endif %}
    </div>

    <!-- Accesos Rápidos -->
    <div class="contenido-principal">
        <div class="encabezado-pagina">
            <h2><i class="fas fa-rocket"></i> Accesos Rápidos</h2>
        </div>
        
        <!-- Botones de Crear -->
        <div class="mb-4">
            <h6 class="text-muted mb-3">Crear Nuevo</h6>
            <div class="row g-2">
                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_contrato' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-file-contract me-2"></i> Nuevo Contrato
                    </a>
                </div>
                {% endif %}
                {% if request.session.rol == 'Administrador' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_tarifa' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-coins me-2"></i> Nueva Tarifa
                    </a>
                </div>
                {% endif %}
                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_notificacion_pago' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-bell me-2"></i> Notificación de Pago
                    </a>
                </div>
                {% endif %}
                {% if request.session.rol == 'Administrador' or request.session.rol == 'Eléctrico' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_notificacion_lectura' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-bell me-2"></i> Notificación de Lectura
                    </a>
                </div>
                {% endif %}
                
                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_cliente' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-user-plus me-2"></i> Nuevo Cliente
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' or request.session.rol == 'Eléctrico' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_lectura' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-plus-circle me-2"></i> Nueva Lectura
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_boleta' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-file-invoice me-2"></i> Nueva Boleta
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_pago' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-hand-holding-usd me-2"></i> Nuevo Pago
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:crear_usuario' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-user-shield me-2"></i> Nuevo Usuario
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Botones de Consultar -->
        <div class="mb-4">
            <h6 class="text-muted mb-3">Consultar</h6>
            <div class="row g-2">
                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:lista_clientes' %}" class="btn btn-primary w-100">
                        <i class="fas fa-users me-2"></i> Ver Clientes
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:lista_usuarios' %}" class="btn btn-primary w-100">
                        <i class="fas fa-user-shield me-2"></i> Ver Usuarios
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:lista_contratos' %}" class="btn btn-primary w-100">
                        <i class="fas fa-file-contract me-2"></i> Ver Contratos
                    </a>
                </div>
                {% endif %}
                {% if request.session.rol == 'Administrador' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:lista_tarifas' %}" class="btn btn-primary w-100">
                        <i class="fas fa-coins me-2"></i> Ver Tarifas
                    </a>
                </div>
                {% endif %}
                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' or request.session.rol == 'Eléctrico' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:lista_notificaciones' %}" class="btn btn-primary w-100">
                        <i class="fas fa-bell me-2"></i> Ver Notificaciones
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' or request.session.rol == 'Eléctrico' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:lista_medidores' %}" class="btn btn-primary w-100">
                        <i class="fas fa-search me-2"></i> Ver Medidores
                    </a>
                </div>
                {% endif %}

                {% if request.session.rol == 'Administrador' or request.session.rol == 'Finanzas' %}
                <div class="col-md-6 col-lg-3">
                    <a href="{% url 'sistemaGestion:lista_boletas' %}" class="btn btn-primary w-100">
                        <i class="fas fa-file-invoice me-2"></i> Ver Boletas
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Notificaciones Recientes (al final del dashboard) -->
    {% if notificaciones %}
    <div class="card mt-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-bell"></i> Notificaciones Recientes
                {% if total_notificaciones > 0 %}
                <span class="badge bg-danger">{{ total_notificaciones }}</span>
                {% endif %}
            </h5>
            <a href="{% url 'sistemaGestion:lista_notificaciones' %}" class="btn btn-sm btn-primary">
                Ver todas
            </a>
        </div>
        <div class="card-body p-0">
            <div class="list-group list-group-flush">
                {% for notif in notificaciones %}
                <a href="{% if notif.tipo == 'pago' %}{% url 'sistemaGestion:detalle_notificacion_pago' notif.id %}{% else %}{% url 'sistemaGestion:detalle_notificacion_lectura' notif.id %}{% endif %}" 
                   class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 align-items-center">
                        <div class="me-3">
                            {% if notif.tipo == 'pago' %}
                            <i class="fas fa-dollar-sign fa-2x text-warning"></i>
                            {% else %}
                            <i class="fas fa-bolt fa-2x text-info"></i>
                            {% endif %}
                        </div>
                        <div class="flex-grow-1">
                            <p class="mb-1">{{ notif.mensaje|truncatewords:15 }}</p>
                            <small class="text-muted">
                                <i class="fas fa-clock"></i> {{ notif.fecha|date:"d/m/Y H:i" }}
                            </small>
                        </div>
                        <div>
                            <i class="fas fa-chevron-right text-muted"></i>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

{% endblock %}

{% block extra_scripts %}
{% endblock %}
