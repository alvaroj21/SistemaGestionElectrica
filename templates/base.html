<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema Eléctrico{% endblock %}</title>
    
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    {% if request.session.user_logged %}
    <div class="contenedor">
        <nav class="barra-navegacion">
            <div class="marca-navegacion">
                <img src="{% static 'images/logo.png' %}" alt="Logo Sistema Eléctrico" class="logotipo">
                <h1>Sistema Eléctrico</h1>
            </div>
            <div class="usuario-navegacion">
                <span>{{ nombre|default:username }} ({{ rol|capfirst }})</span>
                <a href="{% url 'sistemaGestion:logout' %}" class="boton boton-contorno">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </a>
            </div>
        </nav>

        <div class="diseno-principal">
            <aside class="barra-lateral">
                <div class="menu-navegacion">
                    <div class="elemento-navegacion">
                        <a href="{% url 'sistemaGestion:dashboard' %}">
                            <i class="fas fa-home"></i> Inicio
                        </a>
                    </div>
                    
                    <!-- Módulo Eléctrico -->
                    {% if 'medidores' in permisos or 'lecturas' in permisos %}
                    <div class="categoria-navegacion">
                        <div class="titulo-categoria-navegacion" onclick="alternarCategoria(this)">
                            <i class="fas fa-bolt"></i> Módulo Eléctrico <span class="flecha">▼</span>
                        </div>
                        <div class="contenido-categoria-navegacion">
                            {% if 'medidores' in permisos %}
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_medidores' %}">
                                    <i class="fas fa-tachometer-alt"></i> Medidores
                                </a>
                            </div>
                            {% endif %}
                            {% if 'lecturas' in permisos %}
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_lecturas' %}">
                                    <i class="fas fa-chart-line"></i> Lecturas
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Módulo Clientes -->
                    {% if 'clientes' in permisos %}
                    <div class="categoria-navegacion">
                        <div class="titulo-categoria-navegacion" onclick="alternarCategoria(this)">
                            <i class="fas fa-users"></i> Módulo Clientes <span class="flecha">▼</span>
                        </div>
                        <div class="contenido-categoria-navegacion">
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_clientes' %}">
                                    <i class="fas fa-user-friends"></i> Clientes
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Módulo Contratos -->
                    {% if 'contratos' in permisos or 'tarifas' in permisos %}
                    <div class="categoria-navegacion">
                        <div class="titulo-categoria-navegacion" onclick="alternarCategoria(this)">
                            <i class="fas fa-file-contract"></i> Módulo Contratos <span class="flecha">▼</span>
                        </div>
                        <div class="contenido-categoria-navegacion">
                            {% if 'contratos' in permisos %}
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_contratos' %}">
                                    <i class="fas fa-handshake"></i> Contratos
                                </a>
                            </div>
                            {% endif %}
                            {% if 'tarifas' in permisos %}
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_tarifas' %}">
                                    <i class="fas fa-dollar-sign"></i> Tarifas
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Módulo Facturación -->
                    {% if 'boletas' in permisos or 'pagos' in permisos %}
                    <div class="categoria-navegacion">
                        <div class="titulo-categoria-navegacion" onclick="alternarCategoria(this)">
                            <i class="fas fa-calculator"></i> Módulo Facturación <span class="flecha">▼</span>
                        </div>
                        <div class="contenido-categoria-navegacion">
                            {% if 'boletas' in permisos %}
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_boletas' %}">
                                    <i class="fas fa-receipt"></i> Boletas
                                </a>
                            </div>
                            {% endif %}
                            {% if 'pagos' in permisos %}
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_pagos' %}">
                                    <i class="fas fa-credit-tarjeta"></i> Pagos
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Módulo Administración -->
                    {% if 'usuarios' in permisos %}
                    <div class="categoria-navegacion">
                        <div class="titulo-categoria-navegacion" onclick="alternarCategoria(this)">
                            <i class="fas fa-cog"></i> Módulo Administración <span class="flecha">▼</span>
                        </div>
                        <div class="contenido-categoria-navegacion">
                            <div class="elemento-navegacion">
                                <a href="{% url 'sistemaGestion:lista_usuarios' %}">
                                    <i class="fas fa-user-cog"></i> Usuarios
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Notificaciones -->
                    <div class="elemento-navegacion">
                        <a href="{% url 'sistemaGestion:lista_notificaciones' %}">
                            <i class="fas fa-bell"></i> Notificaciones
                            {% if notifications_count > 0 %}
                            <span class="insignia-notificacion">{{ notifications_count }}</span>
                            {% endif %}
                        </a>
                    </div>
                </div>
            </aside>

            <main class="contenido">
                <h2>{% block page_title %}Inicio{% endblock %}</h2>
                
                {% if messages %}
                    {% for message in messages %}
                        <div class="mensaje mensaje-{{ message.tags }}">
                            <i class="fas fa-info-circle"></i> {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}

                {% block content %}
                <p>Bienvenido al Sistema Eléctrico</p>
                {% endblock %}
            </main>
        </div>
    </div>
    {% else %}
    <!-- Si no está logueado, mostrar solo el contenido (login) -->
    {% block login_content %}
    {% endblock %}
    {% endif %}
    
    <script>
        function alternarCategoria(element) {
            const content = element.nextElementSibling;
            const arrow = element.querySelector('.flecha');
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                arrow.textContent = '▲';
                element.classList.add('active');
            } else {
                content.style.display = 'none';
                arrow.textContent = '▼';
                element.classList.remove('active');
            }
        }
        
        // Inicializar todas las categorías como cerradas
        document.addEventListener('DOMContentLoaded', function() {
            const contents = document.querySelectorAll('.contenido-categoria-navegacion');
            contents.forEach(content => {
                content.style.display = 'none';
            });
        });
    </script>
</body>
</html>


